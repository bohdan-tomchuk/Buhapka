# Buhapka Automated Backup Cron Job Examples
#
# To install:
# 1. Edit this file with your actual paths
# 2. Copy the desired cron job line
# 3. Run: crontab -e
# 4. Paste the line and save
# 5. Verify with: crontab -l
#
# Cron format:
# ┌─────────── minute (0 - 59)
# │ ┌───────── hour (0 - 23)
# │ │ ┌─────── day of month (1 - 31)
# │ │ │ ┌───── month (1 - 12)
# │ │ │ │ ┌─── day of week (0 - 6) (Sunday to Saturday)
# │ │ │ │ │
# * * * * * command to execute

# ============================================
# RECOMMENDED: Daily backup at 3:00 AM
# ============================================
0 3 * * * /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/cron.log 2>&1

# ============================================
# Alternative Schedules
# ============================================

# Every day at 2:30 AM
# 30 2 * * * /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/cron.log 2>&1

# Every 6 hours (at 00:00, 06:00, 12:00, 18:00)
# 0 */6 * * * /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/cron.log 2>&1

# Every 12 hours (at 03:00 and 15:00)
# 0 3,15 * * * /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/cron.log 2>&1

# Every Sunday at midnight (weekly backup)
# 0 0 * * 0 /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/cron.log 2>&1

# First day of every month at 02:00 (monthly backup)
# 0 2 1 * * /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/cron.log 2>&1

# Monday to Friday at 23:00 (weekday backups only)
# 0 23 * * 1-5 /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/cron.log 2>&1

# ============================================
# With Off-site Sync (after backup completes)
# ============================================

# Daily backup at 3 AM, then sync to AWS S3 at 4 AM
# 0 3 * * * /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/cron.log 2>&1
# 0 4 * * * aws s3 sync /opt/buhapka/backups/ s3://my-backup-bucket/buhapka/ --delete >> /opt/buhapka/backups/sync.log 2>&1

# Daily backup at 3 AM, then rsync to remote server at 4 AM
# 0 3 * * * /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/cron.log 2>&1
# 0 4 * * * rsync -avz /opt/buhapka/backups/ user@backup-server:/backups/buhapka/ >> /opt/buhapka/backups/rsync.log 2>&1

# ============================================
# With Email Notifications (requires mailutils)
# ============================================

# Backup with success notification
# 0 3 * * * /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/cron.log 2>&1 && echo "Backup completed successfully" | mail -s "Buhapka Backup Success" admin@example.com

# Backup with failure notification (only sends email on error)
# 0 3 * * * /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/cron.log 2>&1 || echo "Backup FAILED! Check logs immediately." | mail -s "Buhapka Backup FAILED" admin@example.com

# ============================================
# Health Check: Alert if no recent backup
# ============================================

# Check every day at 10:00 if backup exists from last 48 hours
# 0 10 * * * [ $(find /opt/buhapka/backups -name "db_*.sql.gz" -mtime -2 | wc -l) -eq 0 ] && echo "WARNING: No recent backup found!" | mail -s "Buhapka Backup Alert" admin@example.com

# ============================================
# Environment Variables
# ============================================

# Set environment variables in crontab (place at top of crontab file):
# BACKUP_DIR=/custom/backup/path
# DB_CONTAINER=custom-postgres
# PATH=/usr/local/bin:/usr/bin:/bin
# MAILTO=admin@example.com

# ============================================
# Testing
# ============================================

# Test cron job every minute (for testing only - remove after verification!)
# * * * * * /opt/buhapka/scripts/backup.sh >> /opt/buhapka/backups/test.log 2>&1

# ============================================
# Notes
# ============================================
#
# 1. Always use absolute paths in cron jobs
# 2. Redirect output to log file: >> /path/to/log.log 2>&1
# 3. Test the script manually before adding to cron
# 4. Check cron execution: grep CRON /var/log/syslog
# 5. Verify logs are being created and rotated
# 6. Set up log rotation for cron.log to prevent disk fill
#
# Log rotation example (/etc/logrotate.d/buhapka-backup):
# /opt/buhapka/backups/*.log {
#     daily
#     rotate 7
#     compress
#     missingok
#     notifempty
# }
